<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="google8465b8d8518e96e5">
  <meta name="baidu-site-verification" content="Gf29SMWHjS">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhj.forever305.cn","root":"/","scheme":"Gemini","version":"7.7.1","exturl":true,"sidebar":{"position":"left","width":250,"display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":20},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="实验名称：Android 后台服务 实验目的：通过Service设计后台服务程序，通过Broadcast实现信息广播机制 实验内容：  设计一个简单的后台音乐服务程序 设计一个简单的信息广播程序示例 利用Broadcast实现后台服务广播音乐的播放或暂停信息，接收器接收到信息后执行改变用户界面按钮上文本的操作">
<meta property="og:type" content="article">
<meta property="og:title" content="Android——后台服务">
<meta property="og:url" content="https://zhj.forever305.cn/2019/05/19/Android_BackGround/index.html">
<meta property="og:site_name" content="厚今的博客">
<meta property="og:description" content="实验名称：Android 后台服务 实验目的：通过Service设计后台服务程序，通过Broadcast实现信息广播机制 实验内容：  设计一个简单的后台音乐服务程序 设计一个简单的信息广播程序示例 利用Broadcast实现后台服务广播音乐的播放或暂停信息，接收器接收到信息后执行改变用户界面按钮上文本的操作">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091445752.png#pic_center=430x130">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091750452.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091551109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091609232.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091621865.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091810773.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091824992.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091833889.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519091841808.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092010310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092037258.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092107231.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092147382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092209444.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092219642.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092229689.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092237862.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092250174.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092305893.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092324893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092336960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092353580.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092419314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092515510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092532266.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092555854.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092610377.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092625477.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092643858.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092811106.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092820391.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092830838.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092846785.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092911513.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092940396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519092954221.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093147557.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093201886.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093222703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093236316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093304303.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093353185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093418772.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2019051909344514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2019051909351128.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2019051909352633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093541911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2019051909355731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093616677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190519093623453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500">
<meta property="article:published_time" content="2019-05-19T03:42:16.000Z">
<meta property="article:modified_time" content="2019-05-19T03:42:16.000Z">
<meta property="article:author" content="Zhang H.J.">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20190519091445752.png#pic_center=430x130">

<link rel="canonical" href="https://zhj.forever305.cn/2019/05/19/Android_BackGround/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Android——后台服务 | 厚今的博客</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d41b533303589d4d0a4651614a6d51ef";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="厚今的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">厚今的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Zhang HJ's Blog</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">33</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">27</span></a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-网站状态">

    <span class="exturl" data-url="aHR0cHM6Ly9zdGF0dXMuemhqLmZvcmV2ZXIzMDUuY24v"><i class="fa fa-fw fa-shield"></i>网站状态</span>

  </li>
        <li class="menu-item menu-item-更新日志">

    <a href="/log/" rel="section"><i class="fa fa-fw fa-paper-plane"></i>更新日志</a>

  </li>
        <li class="menu-item menu-item-个人网盘">

    <span class="exturl" data-url="aHR0cDovLzQ3Ljk1LjEzLjIzOTo4ODg4"><i class="fa fa-fw fa-jsfiddle"></i>个人网盘</span>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL1pISjAxMjU=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zhj.forever305.cn/2019/05/19/Android_BackGround/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhang H.J.">
      <meta itemprop="description" content="Talk is cheap, Show me the code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="厚今的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          Android——后台服务
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-19 11:42:16" itemprop="dateCreated datePublished" datetime="2019-05-19T11:42:16+08:00">2019-05-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">技术笔记</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/%E6%95%99%E5%AD%A6%E5%AE%9E%E8%AE%AD/" itemprop="url" rel="index">
                    <span itemprop="name">教学实训</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/05/19/Android_BackGround/" class="post-meta-item leancloud_visitors" data-flag-title="Android——后台服务" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/05/19/Android_BackGround/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/05/19/Android_BackGround/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>23k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>38 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <ul>
<li>实验名称：Android 后台服务</li>
<li>实验目的：通过Service设计后台服务程序，通过Broadcast实现信息广播机制</li>
<li>实验内容：
<ul>
<li>设计一个简单的后台音乐服务程序</li>
<li>设计一个简单的信息广播程序示例</li>
<li>利用Broadcast实现后台服务广播音乐的播放或暂停信息，接收器接收到信息后执行改变用户界面按钮上文本的操作</li>
</ul>
</li>
</ul>
<a id="more"></a>
<h2 id="一、后台音乐服务程序"><a class="header-anchor" href="#一、后台音乐服务程序">¶</a>一、后台音乐服务程序</h2>
<h3 id="1-1-实验原理"><a class="header-anchor" href="#1-1-实验原理">¶</a>1.1 实验原理</h3>
<p>通过按钮触发启动后台服务程序，进行后台服务的创建、启动和初始化，在服务程序中播放音乐。再通过按钮触发服务程序的销毁。</p>
<h3 id="1-2-实验过程记录"><a class="header-anchor" href="#1-2-实验过程记录">¶</a>1.2 实验过程记录</h3>
<h4 id="1-2-1布局文件"><a class="header-anchor" href="#1-2-1布局文件">¶</a>1.2.1布局文件</h4>
<p>为实现基本的程序效果，使用最简便的线性布局，将水平方式设置为vertical垂直布局。首先在线性布局中添加一个Textview组件，用来显示当前程序中，服务的执行状态。然后添加两个Button组件，分别用来触发开启后台服务和关闭后台服务。</p>
<h4 id="1-2-2控制文件"><a class="header-anchor" href="#1-2-2控制文件">¶</a>1.2.2控制文件</h4>
<h5 id="1-2-2-1实例化对象"><a class="header-anchor" href="#1-2-2-1实例化对象">¶</a>1.2.2.1实例化对象</h5>
<p>修改MainActivity.java文件，以实现对程序的控制。首先，如下图所示，实例化所需要的对象。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091445752.png#pic_center=430x130" alt="图1.1实例化对象"></p>
<p>在上图中，分别实例化了用于触发事件的“Button”对象“startbtn”和“stopbtn”、与后台服务相关的“Context”对象“context”、用于在主控文件和服务控制文件之间传递信息的“Intent”对象“intent”、以及用于显示服务进程当前状态的“Textview”对象“txt”。</p>
<h5 id="1-2-2-2重载onCreate方法"><a class="header-anchor" href="#1-2-2-2重载onCreate方法">¶</a>1.2.2.2重载onCreate方法</h5>
<p>对构造函数进行修改，使其实现“关联布局文件和控制文件、设置按钮监听事件、创建intent对象”的功能。如图1.2所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091750452.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图1.2重载onCreate方法"></p>
<p>首先，通过findViewById方法关联图1.1中的相关组件，并为“startbtn”和“stopbtn”分别设置监听事件。之后，新建一个intent对象，将MainActivity和AudioSrv类相互绑定，使他们之间可以相互传递信息。</p>
<h5 id="1-2-2-3编写mClick函数"><a class="header-anchor" href="#1-2-2-3编写mClick函数">¶</a>1.2.2.3编写mClick函数</h5>
<p>为按钮的监听事件编写 mClick 类，以实现后台服务的开启和关闭功能。如图 1.3 所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091551109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图1.3编写mClick函数"></p>
<p>上图中，构造了一个继承于 OnClickListener 的 mClick 类。通过判断点击按钮传入的参数v，可以对开启和结束服务进行区分，通过intent绑定机制，将信息传递给AudioSrv。之后分别通过setText方法，设置文本框的提示内容。</p>
<h5 id="1-2-2-4编写AudioSrv服务程序"><a class="header-anchor" href="#1-2-2-4编写AudioSrv服务程序">¶</a>1.2.2.4编写AudioSrv服务程序</h5>
<p>新建一个AudioSrv.java文件，用于创建消息服务程序。首先实例化对象，创建AudioSrv类，如图1.4所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091609232.png#pic_center" alt="图1.4创建AudioSrv类"></p>
<p>上图中，构造了一个继承于 Service 的 AudioSrv 类，用于描述所要执行的服务。之后创建了一个MediaPlayer类的play对象，用于执行媒体音频相关的服务。</p>
<h5 id="1-2-2-5重载AudioSrv构造方法"><a class="header-anchor" href="#1-2-2-5重载AudioSrv构造方法">¶</a>1.2.2.5重载AudioSrv构造方法</h5>
<p>创建AudioSrv对象之后，会默认调用三个构造函数，分别为onBind、onCreate、onStartCommand、和onDestroy。</p>
<p>①首先重载onBind函数，如图1.5所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091621865.png#pic_center" alt="图1.5重载onBind函数"></p>
<p>onBind方法用于与服务通信的信道进行绑定，这里返回空值。</p>
<p>②重载onCreate方法，如图1.6所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091810773.png#pic_center" alt="图1.6重载onCreate方法"></p>
<p>onBind方法用于创建后台服务程序。首先，使用MediaPlayer.create() 方法调用资源文件中的音频对象。之后，通过Toast创建一个提示框，用于显示当前服务状态信息。</p>
<p>③重载onStartCommand方法，如图1.7所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091824992.png#pic_center" alt="图1.7重载onStartCommand方法"></p>
<p>onBind方法用于启动后台服务程序。使用start方法启动play对象的播放进程，从而实现音频文件的播放。之后再通过Toast创建一个提示框，用于显示当前服务状态信息。</p>
<p>④重载 onDestroy方法，如图1.8所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091833889.png#pic_center" alt="图1.8重载 onDestroy方法"></p>
<p>onDestroy方法用于销毁所有的后台服务程序，同时删除所有的服务调用。使用release方法释放媒体对象的调用，同时通过Toast显示提示消息。</p>
<h4 id="1-2-3-配置文件"><a class="header-anchor" href="#1-2-3-配置文件">¶</a>1.2.3 配置文件</h4>
<p>由于程序中涉及到了与服务相关的AudioSrv.java文件，所以需要在AndroidManifest.xml文件中，对其进行相关注册和配置。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519091841808.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图1.9配置文件"></p>
<p>如上图1.9所示，在原有的配置文件中，增加红色箭头所指部分，为AudioSrv注册service服务的权限。</p>
<h4 id="1-2-4引入音频文件资源"><a class="header-anchor" href="#1-2-4引入音频文件资源">¶</a>1.2.4引入音频文件资源</h4>
<p>为了能够确保后台音频服务正常启动，需要事先向项目目录中，添加音频文件资源。首先，如图1.10所示，在res目录下新建一个raw资源目录。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092010310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图1.10创建资源目录"></p>
<p>在资源类型选项栏中，选择raw类型，如上图中红色箭头所示。之后，将本地的音频文件复制到res/raw文件夹下即可。</p>
<h3 id="1-3-实验中存在的问题及解决方案"><a class="header-anchor" href="#1-3-实验中存在的问题及解决方案">¶</a>1.3 实验中存在的问题及解决方案</h3>
<p>资源文件的文件命名问题</p>
<p>一开始我将引入的音频文件命名为happyWhistlingUkulele.mp4，编译之后出现如图1.11所示的错误信息：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092037258.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图1.11报错信息截图"></p>
<p>错误信息为：</p>
<p>“E:\AndroidStudio\homework\five\ex5_1\app\src\main\res\raw\happyWhistlingUkulele.mp4: Error: ‘W’ is not a valid file-based resource name character: File-based resource names must contain only lowercase a-z, 0-9, or underscore”。根据错误提示信息，资源文件名只能包含小写字母、数字以及下划线。于是我将文件名修改问happy.mp3，错误得以解决。</p>
<h3 id="1-4-实验结果"><a class="header-anchor" href="#1-4-实验结果">¶</a>1.4 实验结果</h3>
<p>程序具体运行效果请查看视频：<span class="exturl" data-url="aHR0cDovLzQ3Ljk1LjEzLjIzOS9TdHVkeS9BbmRyb2lkL3Nob3cvZXg1XzEubXA0" title="http://47.95.13.239/Study/Android/show/ex5_1.mp4">http://47.95.13.239/Study/Android/show/ex5_1.mp4<i class="fa fa-external-link"></i></span></p>
<p>程序编写结束后，启动安卓模拟器进行程序模拟运行。点击“启动后台音乐服务程序”，音乐开始播放，效果如图1.12和图1.13所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092107231.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图1.12 开启服务"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092147382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图1.13关闭服务"></p>
<p>之后，点击“关闭后台音乐服务程序”，正在播放的音乐便停止播放。为了测试该服务是否是在后台运行，首先启动音乐服务，之后退出该APP至手机主界面，音乐依然正常播放。说明该音乐播放服务正在后台运行。</p>
<h2 id="二、信息广播程序"><a class="header-anchor" href="#二、信息广播程序">¶</a>二、信息广播程序</h2>
<h3 id="2-1实验原理"><a class="header-anchor" href="#2-1实验原理">¶</a>2.1实验原理</h3>
<p>Broadcast是Android系统应用程序之间传递数据的一种机制。当系统间需要传递某些信息时，由系统自身通过系统调用来引发事件。这种调用是由Broadcast类来实现的，这种系统调用称为广播机制。</p>
<h3 id="2-2-实验过程记录"><a class="header-anchor" href="#2-2-实验过程记录">¶</a>2.2 实验过程记录</h3>
<h4 id="2-2-1布局文件"><a class="header-anchor" href="#2-2-1布局文件">¶</a>2.2.1布局文件</h4>
<p>为实现基本的程序效果，使用最简便的线性布局，将水平方式设置为vertical垂直布局。首先在线性布局中添加一个TextView组件，用来显示接收到的广播消息。然后添加一个Button组件，分别用来触发广播消息的发送。</p>
<h4 id="2-2-2控制文件"><a class="header-anchor" href="#2-2-2控制文件">¶</a>2.2.2控制文件</h4>
<h5 id="2-2-2-1实例化对象"><a class="header-anchor" href="#2-2-2-1实例化对象">¶</a>2.2.2.1实例化对象</h5>
<p>修改MainActivity.java文件，以实现对程序的控制。首先，如下图所示，实例化所需要的对象。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092209444.png#pic_center" alt="图2.1实例化对象"></p>
<p>在上图中，分别实例化了用于触发广播事件的“Button”对象“btn”,以及用于显示广播信息内容的“TextView”对象“txt”。</p>
<h5 id="2-2-2-2重载onCreate方法"><a class="header-anchor" href="#2-2-2-2重载onCreate方法">¶</a>2.2.2.2重载onCreate方法</h5>
<p>对构造函数进行修改，使其实现“关联布局文件和控制文件、设置按钮监听事件、创建intent对象”的功能。如图2.2所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092219642.png#pic_center" alt="图2.2重载onCreate方法"></p>
<p>通过findViewById方法关联Textview和Button组件，并为“btn”对象设置监听事件。</p>
<h5 id="2-2-2-3编写mClick函数"><a class="header-anchor" href="#2-2-2-3编写mClick函数">¶</a>2.2.2.3编写mClick函数</h5>
<p>为按钮的监听事件编写 mClick 类，以实现广播功能的开启。如图 2.3 所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092229689.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图2.3编写mClick函数"></p>
<p>上图中，构造了一个继承于 OnClickListener 的 mClick 类。首先创建一个intent对象，并设置该对象的action属性。然后创建一个bundle对象，通过键值对的形式封装广播信息。最后sendBroadcast方法将intent广播出去。</p>
<h5 id="2-2-2-4编写TestReceiver控制程序"><a class="header-anchor" href="#2-2-2-4编写TestReceiver控制程序">¶</a>2.2.2.4编写TestReceiver控制程序</h5>
<p>新建一个TestReceiver.java文件，用于接收广播消息并通过Textview组件进行显示，如图2.4所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092237862.png#pic_center" alt="图2.4编写TestReceiver类"></p>
<p>上图中，定义了一个str字符串，通过getExtras方法接收键为hello的字符串，并通过setText方法将textview组件的内容设置为str字符串。</p>
<h4 id="2-2-3-配置文件"><a class="header-anchor" href="#2-2-3-配置文件">¶</a>2.2.3 配置文件</h4>
<p>由于程序中涉及到了与接收广播消息相关的TestReceiver.java文件，所以需要在AndroidManifest.xml文件中，对其进行相关注册和配置，如图2.5所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092250174.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图2.5配置文件修改"></p>
<p>如上图2.5所示，在原有的文件中追加红框中的内容，以注册TestReceiver.java文件和该文件的action属性。</p>
<h3 id="2-3-实验中存在的问题及解决方案"><a class="header-anchor" href="#2-3-实验中存在的问题及解决方案">¶</a>2.3 实验中存在的问题及解决方案</h3>
<blockquote>
<p>广播消息接收不正常</p>
</blockquote>
<p>编写完程序之后，我在电脑的安卓模拟器上进行测试，模拟器版本是Android9.0，API版本28。在该版本的模拟器上，广播消息接收不正常。为了测试程序是否进入了onReceiver构造函数，我改写该函数，在函数中添加“MainActivity.txt.setText(“Here…”);”语句(如图2.6所示)，试图判断：在点击按钮之后，或者说是广播发出之后，程序是否进入了onReceiver函数。如果程序正常进入到了该函数，则可以在TextView中显示Here标志，说明广播接收功能正常，那么问题可能出在intent的键值和页面绑定等方面；如果程序不能正常在TextView中显示Here标志，那么说明广播的接收功能异常，问题可能出现在action属性等方面。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092305893.png#pic_center" alt="图2.6 查找广播接收问题原因"></p>
<p>下面运行程序，发现再点击按钮之后，不能正常显示&quot;Here…&quot;字符串。我猜测(依据上次做简易相机的经历)问题有可能出在Android版本上，于是重新创建了一个Android7.1.1，API25版本的安卓模拟器，再次运行程序。结果程序正常运行(如图2.8所示)，接收到了广播消息。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092324893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图2.7点击按钮之前的初始化界面"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092336960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图2.8接收到广播消息的界面"></p>
<p>图2.7是点击按钮之前的初始化界面，图2.8是点击按钮之后，接收到广播消息的界面。可以看到，intent正常接收到了广播消息，并通过setText方法将得到的文本信息正常显示在了textview组件上。</p>
<p>那么，问题是否真的是由于Android版本造成的呢?我将程序再次放到Android9.0的模拟器上运行，发现再点击按钮之后，程序依然没有反应。所以说该问题确实与Android版本有关。</p>
<h3 id="2-4-实验结果"><a class="header-anchor" href="#2-4-实验结果">¶</a>2.4 实验结果</h3>
<p>程序具体运行效果请查看视频：<span class="exturl" data-url="aHR0cDovLzQ3Ljk1LjEzLjIzOS9TdHVkeS9BbmRyb2lkL3Nob3cvZXg1XzIubXA0" title="http://47.95.13.239/Study/Android/show/ex5_2.mp4">http://47.95.13.239/Study/Android/show/ex5_2.mp4<i class="fa fa-external-link"></i></span></p>
<p>根据之前调试的问题及解决方法，我将笔记本上的模拟器版本更新为Android7.1.1，运行程序，效果如下图2.9、2.10所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092353580.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图2.9初始化界面"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092419314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图2.10接收广播界面"></p>
<p>在初始化界面(图2.9)中，textview文本框中显示“广播消息Broadcast测试”，之后点击发送消息按钮，程序将发送广播消息，并通过intent接收，最后将接收到的消息显示在textview组件上，实现上图2.10中的效果。</p>
<h2 id="三、后台服务广播音乐的播放或暂停"><a class="header-anchor" href="#三、后台服务广播音乐的播放或暂停">¶</a>三、后台服务广播音乐的播放或暂停</h2>
<h3 id="3-1实验原理"><a class="header-anchor" href="#3-1实验原理">¶</a>3.1实验原理</h3>
<p>通过一个后台服务程序，广播音乐的播放或暂停信息，接收器接收到信息之后，执行改变用户界面上的文本操作。</p>
<h3 id="3-2实验过程记录"><a class="header-anchor" href="#3-2实验过程记录">¶</a>3.2实验过程记录</h3>
<h4 id="3-2-1布局文件"><a class="header-anchor" href="#3-2-1布局文件">¶</a>3.2.1布局文件</h4>
<p>布局文件同样采用线性布局，根据程序需求，只需要添加两个Button组件，分别用来表示播放和停止按钮。</p>
<h4 id="3-2-2控制文件"><a class="header-anchor" href="#3-2-2控制文件">¶</a>3.2.2控制文件</h4>
<h5 id="3-2-2-1实例化对象"><a class="header-anchor" href="#3-2-2-1实例化对象">¶</a>3.2.2.1实例化对象</h5>
<p>修改MainActivity.java文件，以实现对程序的控制。首先，如下图3.1所示，实例化所需要的对象。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092515510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.1实例化对象"></p>
<p>在上图中，分别实例化了用于触发事件的“Button”类的对象“btnStart”和“btnStop”、与广播服务相关的“Broadcast”类的对象“mBroadcast”、用于在主控文件和服务控制文件之间传递信息的“Intent”类的对象“intent”，并且设置了音频文件的路径变量字符串AUDIO_PATH。</p>
<h5 id="3-2-2-2重载onCreate方法"><a class="header-anchor" href="#3-2-2-2重载onCreate方法">¶</a>3.2.2.2重载onCreate方法</h5>
<p>对构造函数进行修改，使其实现“关联布局文件和控制文件、创建filter对象、注册广播接收器”的功能。如图3.2所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092532266.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.2重载onCreate方法"></p>
<p>首先，通过findViewById方法关联图3.1中的相关组件，之后，新建一个filter对象，并将其action设置为“music”。创建Broadcast类的mBroadcast对象，并使用registerReceiver方法注册广播监听器。</p>
<h5 id="3-2-2-3重载onDestroy方法"><a class="header-anchor" href="#3-2-2-3重载onDestroy方法">¶</a>3.2.2.3重载onDestroy方法</h5>
<p>在关闭接收器之后，我们需要取消注册广播接收器，如图3.3所示，重载onDestroy方法。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092555854.png#pic_center" alt="图3.3重载onDestroy方法"></p>
<p>为防止内存溢出等意外情况，需要在onDestroy方法中，使用unregisterReceiver函数取消对广播接收器的注册。</p>
<h5 id="3-2-2-4编写ClickHandler函数"><a class="header-anchor" href="#3-2-2-4编写ClickHandler函数">¶</a>3.2.2.4编写ClickHandler函数</h5>
<p>程序通过对按钮的监听，来触发事件，从而做出反应。下面编写ClickHandler函数，用来对按钮的监听事件做出处理，如图3.4所示。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092610377.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.4编写ClickHandler函数"></p>
<p>ClickHandler函数首先通过getId方法，取出参数v所对应组件的id，之后通过switch\case语句进行判断。如果点击了id为btnPlayOrPause的组件，就通过intent对象在主控文件和AudioService类之间传递数据，通过startService方法开启intent所绑定的服务；如果点击了id为btnStop的组件，就结束intent所绑定的服务。</p>
<h5 id="3-2-2-5编写AudioService控制文件"><a class="header-anchor" href="#3-2-2-5编写AudioService控制文件">¶</a>3.2.2.5编写AudioService控制文件</h5>
<p>新建一个AudioService.java文件，用于具体的广播消息的服务。</p>
<p>①首先实例化相关的对象，如图3.5所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092625477.png#pic_center" alt="图3.5实例化对象"></p>
<p>在上图中，分别实例化了用于传递数据的“Intent”类的对象“intent2”和“Bundle”类的对象“bundle2”、与媒体播放服务相关的“MediaPlayer”类的对象“mediaPlayer”、以及用于表示媒体文件路径的“String”类的对象“audioPath”。</p>
<p>②重载onBind方法，如图3.6所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092643858.png#pic_center" alt="图3.6重载onBind函数"></p>
<p>onBind方法用于与服务通信的信道进行绑定，这里返回空值。</p>
<p>③重载 onStartCommand方法，如图3.7所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092811106.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.7重载onStartCommand函数"></p>
<p>onStartCommand函数实现的功能是：控制媒体文件的播放、暂停与结束，同时通过调用sendUpdateUI方法，对按钮的文本信息进行修改，具体过程不再赘述。</p>
<p>④重载onDestroy方法，如图3.8所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092820391.png#pic_center" alt="图3.8重载onDestroy函数"></p>
<p>onDestroy方法用于销毁所有的后台服务程序，同时删除所有的服务调用。使用release方法释放媒体对象的调用，同时通过调用sendUpdateUI方法实现对按钮文字的更新。</p>
<p>⑤编写 sendUpdateUI方法，如图3.9所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092830838.png#pic_center" alt="图3.9编写 sendUpdateUI函数"></p>
<p>sendUpdateUI函数用于发送广播消息，后台服务把键名为backFlag的消息广播出去。发送成功后，Activity里的updateUIReceiver的onReceiver方法就能做出相应的更新按钮文字的工作。</p>
<h5 id="3-2-2-6编写-Broadcast控制文件"><a class="header-anchor" href="#3-2-2-6编写-Broadcast控制文件">¶</a>3.2.2.6编写 Broadcast控制文件</h5>
<p>新建一个Broadcast.java文件，用于接收广播消息并通过Textview组件进行界面的更新显示，如图3.10所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092846785.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.10 Broadcast控制文件"></p>
<p>该方法中，重载了onReceiver方法，从intent中获取接收到的广播数据，使用switch\case语句进行判断，其中0是播放、1是暂停，2表示停止播放。</p>
<h4 id="3-2-3配置文件"><a class="header-anchor" href="#3-2-3配置文件">¶</a>3.2.3配置文件</h4>
<p>由于程序中涉及到了与接收广播消息相关的AudioService.java文件，所以需要在AndroidManifest.xml文件中，对其进行相关注册和配置，如图3.11所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092911513.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.11修改配置文件"></p>
<p>如上图2.5所示，在原有的文件中追加红框中的内容，以注册AudioService.java文件和该文件的action属性。</p>
<h3 id="3-3-实验中存在的问题及解决方案"><a class="header-anchor" href="#3-3-实验中存在的问题及解决方案">¶</a>3.3 实验中存在的问题及解决方案</h3>
<h4 id="3-3-1安卓源文件链接失败问题"><a class="header-anchor" href="#3-3-1安卓源文件链接失败问题">¶</a>3.3.1安卓源文件链接失败问题</h4>
<p>编写完成文件之后，经过我的测试，当在AndroidManifest.xml配置文件中，添加有关注册AudioService服务的标签之后，在编译时总会出错，错误信息截图如下图3.12所示。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092940396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.12 编译报错"></p>
<p>在报错信息中，有一句话引起了我的注意“Daemon:  AAPT2 aapt2-3.2.0-4818971-windows Daemon #0”，通过查找相关资料，我了解到：AAPT2是Android Asset Packaging Tool的缩写，是编译和打包资源的工具。之前的错误，是由于AAPT2强校验AndroidManifest.xml中的嵌套关系造成的，说白了就是我在添加service标签的时候，格式错了。于是修改文件为图3.13红框中所示。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519092954221.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.13修改配置文件"></p>
<p>重新进行编译操作，该错误得以解决。</p>
<h4 id="3-3-2-ClickHandler方法未被调用问题"><a class="header-anchor" href="#3-3-2-ClickHandler方法未被调用问题">¶</a>3.3.2 ClickHandler方法未被调用问题</h4>
<p>通过修改配置文件，解决了编译报错问题，然而我发现在MainActivity.java主控文件里，用于被触发的ClickHandler方法显示波浪线，表示该方法未被调用。通过阅读程序我们知道，该ClickHandler方法是用于对按钮被触发后事件的相应，如果他在程序中没有被调用，那么程序运行时一定会出问题。</p>
<p>仔细阅读MainActivity.java文件，我发现在onCreate构造方法中，没有写setOnClickListener方法，当时我认为也许是这里有问题，于是我尝试修改文件，使用setOnClickListener的方式实现监听接口，如图3.14所示。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093147557.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.14更改监听事件"></p>
<p>然而并没有什么用。程序中依然没有调用ClickHandler。我想，也许程序中监听事件的实现方法上没有问题，只是设置监听事件的方式与以往不同。也是我查找了一下资料，发现实现监听事件有四种方式：</p>
<p>①使用匿名内部类的方式实现监听事件。<br>
②使用外部类的方式实现监听事件。<br>
③使用接口方式实现监听事件。<br>
④直接绑定到标签。</p>
<p>在程序里，实际上是使用了第四种方式。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093201886.png#pic_center" alt="图3.15绑定到标签的方式"></p>
<p>(图片引自：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2t5aV96aHUxMjMvYXJ0aWNsZS9kZXRhaWxzLzUyNjAxNjkx" title="https://blog.csdn.net/kyi_zhu123/article/details/52601691">https://blog.csdn.net/kyi_zhu123/article/details/52601691<i class="fa fa-external-link"></i></span>)</p>
<p>这样的话，我需要在原有的基础上，修改布局文件里的内容，为每一个button组件，增加onClick属性，并将其绑定到ClickHandler方法上，于是改写程序为下图3.16所示。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093222703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.16修改布局文件"></p>
<p>如上图3.16所示，增加红色框图中的内容，使button组件全部绑定到ClickHandler方法上。现在，主控文件中的ClickHandler已经不再显示未被调用了。现在编译程序，并在模拟器上运行，在点击播放按钮之后，按钮文字变为了“暂停”，说明现在鼠标的监控事件已经奏效，问题得以解决。</p>
<h4 id="3-3-3音乐服务不播放问题"><a class="header-anchor" href="#3-3-3音乐服务不播放问题">¶</a>3.3.3音乐服务不播放问题</h4>
<p>为了能使程序正常播放音频文件，我通过AndroidStudio的“Device File Explorer”设备文件管理器，将事先准备好的音频文件拷贝到了“/sdcard/Music”文件夹下，名将其命名为“happy.mp3”，同时在主控文件中，将AUDIO_PATH字符串的值改写为“/sdcard/Music/happy.mp3”。运行程序，发现虽然程序能够对鼠标的点击做出相应，但是音频文件依然没有播放。</p>
<p>重启程序，点击播放按钮，并在LogCat下查看程序运行情况。可以看到，在点击播放按钮的时候，日志会输出错误信息，如图3.17所示。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093236316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.17错误日志"></p>
<p>在下面的日志输出框中，用红框圈出的部分表示输出的错误信息，上方代码框中，用红框标出来的表示抛出异常的位置。</p>
<p>问题分析：</p>
<p>仔细看一下，发现报错这个是因为媒体文件初始化的时候，因为此时mediaPlayer 为null，所以需要new一个mediaPlayer对象并进行初始化，问题就出在初始化上。我认为这一部分的代码，能出问题的有两个原因：广播接收到的媒体文件路径问题、或者初始化有逻辑问题。</p>
<p>①首先我来测试一下，是不是因为广播接收器接收到的媒体文件路径audioPath有误，导致mediaPlayer在初始化的时候不能正常找到正确的媒体文件呢？</p>
<p>为了能够得到程序接收到的广播消息，我在布局文件中，增设了一个textview组件，用来显示媒体文件的路径信息，并将onStartCommand方法进行修改，如图3.18所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093304303.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.18修改onStartCommand方法"></p>
<p>我在消息广播接收器接收到数据之后，增加了一个“MainActivity.txt.setText(audioPath);”语句，图中红框所示，用来将接收到的媒体文件路径信息显示在界面的文本框中，从而判断是不是广播消息接收机制出现了问题。</p>
<p>运行代码，并点击“播放”按钮，得到以下结果(图3.19)：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093353185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图3.19运行调试结果"></p>
<p>通过在界面上展示的textview组件，可以看到，当前接收到的媒体文件路径是没有问题的！所以说，问题应该不在于广播接收机制，而是在于媒体播放部分。</p>
<p>我又将媒体路径audioPath直接设置成了“/sdcard/Music/happy.mp3”，但程序在运行的时候，依旧没有音频播放，也依旧会在日志中输出上面提到的错误信息。这更加证明了，程序错误之处在于媒体播放部分。</p>
<p>②这样的话，基本可以确定程序的错误之处在于媒体文件的播放部分。</p>
<p>然而，这部分没有问题。</p>
<p>我在查阅资料的过程中发现，如果想要访问SD卡中的文件，需要在配置文件中声明读取SD卡的权限，之前做的程序中也有类似的增加权限的例子。我这才恍然大悟——忘加SD卡访问权限了。于是我在配置文件中加上了对SD卡的访问权限，在模拟器运行测试。运行成功！问题算是得以解决。</p>
<h4 id="3-3-4动态权限申请"><a class="header-anchor" href="#3-3-4动态权限申请">¶</a>3.3.4动态权限申请</h4>
<p>既然提到了SD卡权限的问题，那就深究一下。之前测试过的程序中，很多因为版本问题不兼容，我发现其原因多数是因为权限的问题。经过查阅资料我发现，在Android6.0版本以后，求权限的管理变得更加严格了，不仅仅需要在配置文件中声明需要申请的权限，而是需要在运行程序的时候进行动态申请。之前由于大家的手机版本普遍都是Android7.0及以上的版本，对权限的管理比较严格，如果仅仅在配置文件中添加申请权限，就会导致在程序开启时，由于没有获取到足够的权限而不能正常运行。</p>
<p>现在尝试去动态申请权限。</p>
<p>①首先在配置文件中声明对SD卡的读取权限，如图3.20所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093418772.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.20增加SD卡读写权限"></p>
<p>②编写 PermisionUtils类</p>
<p>下面编写PermisionUtils类，用于动态权限的申请，如图3.21所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/2019051909344514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center" alt="图3.21动态权限申请"></p>
<p>首先要设置两个私有静态变量，用来表示SD卡的读写权限。之后编写verifyStoragePermissions方法，用来检测和申请SD卡权限。该方法将检测APP程序是否具有SD卡的读写权限，没有权限就会去动态申请，弹出申请对话框，获取用户的允许。</p>
<p>③调用verifyStoragePermissions方法</p>
<p>将写好的verifyStoragePermissions方法在需要授权的地方进行调用，这里我将它置于MainActivity.java的onCreate构造方法中，这样程序首次运行时，都会进行权限的检查。值得注意的是，程序获取SD卡读写权限成功后，就会一直持有该权限。就算你把代码里的verifyStoragePermissions(this); 语句删了，只要不卸载应用程序，权限就仍然存在。</p>
<p>现在可以进行动态权限的测试了。编译并在模拟器上运行，首次运行时，会出现如下图3.22所示的权限申请框。</p>
<p><img data-src="https://img-blog.csdnimg.cn/2019051909351128.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图3.22动态权限申请框"></p>
<p>权限申请框中表述的意思为：是否允许ex5_3这个程序，访问你设备上的照片、媒体和文件吗？点击“ALLOW”表示允许，这样程序就获取了用户所授权的，对SD卡的读写权限。<br>
为了确保动态权限对于高版本的Android设备同样行之有效，我在Android9.0版本的模拟器上进行了测试，首次运行时截图如下图2.23所示：</p>
<p><img data-src="https://img-blog.csdnimg.cn/2019051909352633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图2.23Android9.0版本测试"></p>
<p>首次运行时，同样会显示这样的动态申请框。点击允许之后，接下来的程序运行均正常稳定。</p>
<h3 id="3-4实验结果"><a class="header-anchor" href="#3-4实验结果">¶</a>3.4实验结果</h3>
<p>程序具体运行结果请查看视频：<span class="exturl" data-url="aHR0cDovLzQ3Ljk1LjEzLjIzOS9TdHVkeS9BbmRyb2lkL3Nob3cvZXg1XzMubXA0" title="http://47.95.13.239/Study/Android/show/ex5_3.mp4">http://47.95.13.239/Study/Android/show/ex5_3.mp4<i class="fa fa-external-link"></i></span></p>
<p>将程序卸载并重新在Android9.0版本的模拟器上进行测试。初次运行时，将显示动态权限申请框(如图3.24)，点击“允许”后，进入初始化界面(如图3.25)，点击“播放”即可播放音频文件，此时按钮上的文本由“播放”变为了“暂停”(如图3.26)，点击“暂停”即可暂停音频播放，点击“停止”按钮可停止音频播放(如图3.27)。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093541911.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图3.24权限申请"></p>
<p><img data-src="https://img-blog.csdnimg.cn/2019051909355731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图3.25初始化界面"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093616677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图3.26播放音频"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20190519093623453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pISjEyM0NTRE4=,size_16,color_FFFFFF,t_70#pic_center=230x500" alt="图3.27赞暂停播放"></p>
<h2 id="四、附录"><a class="header-anchor" href="#四、附录">¶</a>四、附录</h2>
<p>说明：附录只包含关键的文件，三个项目的工程文件均已上传至GitHub，如有需要可自行查看。GitHub网址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1pISjAxMjUvQW5kcm9pZExlYW5pbmc=" title="https://github.com/ZHJ0125/AndroidLeaning">https://github.com/ZHJ0125/AndroidLeaning<i class="fa fa-external-link"></i></span></p>
<h3 id="4-1-ex5-1"><a class="header-anchor" href="#4-1-ex5-1">¶</a>4.1 ex5_1</h3>
<h4 id="4-1-1-activity-main-xml"><a class="header-anchor" href="#4-1-1-activity-main-xml">¶</a>4.1.1 activity_main.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/text1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/hello"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"24dp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/btn1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"启动后台音乐服务程序"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"24dp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/btn2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"关闭后台音乐服务程序"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"24dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-1-2-MainActivity-java"><a class="header-anchor" href="#4-1-2-MainActivity-java">¶</a>4.1.2 MainActivity.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    Button startbtn,stopbtn;</span><br><span class="line">    Context context;</span><br><span class="line">    Intent intent;</span><br><span class="line">    <span class="keyword">static</span> TextView txt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        startbtn = (Button)findViewById(R.id.btn1);</span><br><span class="line">        stopbtn = (Button)findViewById(R.id.btn2);</span><br><span class="line">        startbtn.setOnClickListener(<span class="keyword">new</span> mClick());</span><br><span class="line">        stopbtn.setOnClickListener(<span class="keyword">new</span> mClick());</span><br><span class="line">        txt = (TextView)findViewById(R.id.text1);</span><br><span class="line">        intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AudioSrv<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">mClick</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (v == startbtn)&#123;</span><br><span class="line">                MainActivity.<span class="keyword">this</span>.startService(intent);</span><br><span class="line">                txt.setText(<span class="string">"Start Service ......"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (v == stopbtn)&#123;</span><br><span class="line">                MainActivity.<span class="keyword">this</span>.stopService(intent);</span><br><span class="line">                txt.setText(<span class="string">"Stop Service ......"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-1-3-AudioSrv-java"><a class="header-anchor" href="#4-1-3-AudioSrv-java">¶</a>4.1.3 AudioSrv.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.media.MediaPlayer;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudioSrv</span> <span class="keyword">extends</span> <span class="title">Service</span></span>&#123;</span><br><span class="line">    MediaPlayer play;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        play = MediaPlayer.create(<span class="keyword">this</span>, R.raw.happy);</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"创建后台服务..."</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</span><br><span class="line">        play.start();</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"启动后台服务程序，播放音乐..."</span>, Toast.LENGTH_LONG ).show();</span><br><span class="line">        <span class="keyword">return</span> START_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        play.release();</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"销毁后台服务..."</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-1-4-AndroidManifest-xml"><a class="header-anchor" href="#4-1-4-AndroidManifest-xml">¶</a>4.1.4 AndroidManifest.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">"zhj.com.ex5_1"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">".AudioSrv"</span> <span class="attr">android:enabled</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-ex5-2"><a class="header-anchor" href="#4-2-ex5-2">¶</a>4.2 ex5_2</h3>
<p>（只在Android7.0版本上测试通过了）</p>
<h4 id="4-2-1-activity-main-xml"><a class="header-anchor" href="#4-2-1-activity-main-xml">¶</a>4.2.1 activity_main.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/txt1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"广播消息Broadcast测试"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/btn"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"发送消息"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-2-MainActivity-java"><a class="header-anchor" href="#4-2-2-MainActivity-java">¶</a>4.2.2 MainActivity.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> TextView txt;</span><br><span class="line">    Button btn;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        txt = (TextView)findViewById(R.id.txt1);</span><br><span class="line">        btn = (Button)findViewById(R.id.btn);</span><br><span class="line">        btn.setOnClickListener(<span class="keyword">new</span> mClick());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">mClick</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.setAction(<span class="string">"abc"</span>);</span><br><span class="line">            Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">            bundle.putString(<span class="string">"hello"</span>, <span class="string">"这是广播消息"</span>);</span><br><span class="line">            intent.putExtras(bundle);</span><br><span class="line">            sendBroadcast(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3-TestReceiver-java"><a class="header-anchor" href="#4-2-3-TestReceiver-java">¶</a>4.2.3 TestReceiver.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//MainActivity.txt.setText("Here........");</span></span><br><span class="line">        String str = intent.getExtras().getString(<span class="string">"hello"</span>);</span><br><span class="line">        MainActivity.txt.setText(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-2-4-AndroidManifest-xml"><a class="header-anchor" href="#4-2-4-AndroidManifest-xml">¶</a>4.2.4 AndroidManifest.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">"zhj.com.ex5_2"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".TestReceiver"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"abc"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-ex5-3"><a class="header-anchor" href="#4-3-ex5-3">¶</a>4.3 ex5_3</h3>
<h4 id="4-3-1-activity-main-xml"><a class="header-anchor" href="#4-3-1-activity-main-xml">¶</a>4.3.1 activity_main.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"ClickHandler"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/btnPlayOrPause"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"播放"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"ClickHandler"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/btnStop"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"停止"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/txt"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-2-MainActivity-java"><a class="header-anchor" href="#4-3-2-MainActivity-java">¶</a>4.3.2 MainActivity.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.IntentFilter;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> zhj.com.ex5_3.PermisionUtils.verifyStoragePermissions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    Broadcast mBroadcast=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> Button btnStart;</span><br><span class="line">    Button btnStop;</span><br><span class="line">    Intent intent;</span><br><span class="line">    String AUDIO_PATH=<span class="string">"/sdcard/Music/happy.mp3"</span>;</span><br><span class="line">    <span class="keyword">static</span> TextView txt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        verifyStoragePermissions(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        txt = (TextView)findViewById(R.id.txt); <span class="comment">//用于测试广播接收的文件路径是否正确</span></span><br><span class="line">        btnStart=(Button)findViewById(R.id.btnPlayOrPause);</span><br><span class="line">        btnStop=(Button)findViewById(R.id.btnStop);</span><br><span class="line">        IntentFilter filter=<span class="keyword">new</span> IntentFilter(<span class="string">"music"</span>);</span><br><span class="line">        mBroadcast=<span class="keyword">new</span> Broadcast();</span><br><span class="line">        registerReceiver(mBroadcast,filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        unregisterReceiver(mBroadcast);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ClickHandler</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnPlayOrPause:</span><br><span class="line">                intent=<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,zhj.com.ex5_3.AudioService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                Bundle bundle=<span class="keyword">new</span> Bundle();</span><br><span class="line">                bundle.putString(<span class="string">"audioPath"</span>,AUDIO_PATH);</span><br><span class="line">                intent.putExtras(bundle);</span><br><span class="line">                startService(intent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStop:</span><br><span class="line">                <span class="keyword">if</span>(intent != <span class="keyword">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    stopService(intent);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-3-AudioService-java"><a class="header-anchor" href="#4-3-3-AudioService-java">¶</a>4.3.3 AudioService.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.media.MediaPlayer;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudioService</span> <span class="keyword">extends</span> <span class="title">Service</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MediaPlayer mediaPlayer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Intent intent2=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Bundle bundle2=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String audioPath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendUpdateUI</span><span class="params">(<span class="keyword">int</span> flag)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        intent2=<span class="keyword">new</span> Intent();</span><br><span class="line">        intent2.setAction(<span class="string">"music"</span>);</span><br><span class="line">        bundle2=<span class="keyword">new</span> Bundle();</span><br><span class="line">        bundle2.putInt(<span class="string">"backFlag"</span>,flag);</span><br><span class="line">        intent2.putExtras(bundle2);</span><br><span class="line">        sendBroadcast(intent2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent,<span class="keyword">int</span> flags,<span class="keyword">int</span> startId)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStartCommand(intent,flags,startId);</span><br><span class="line">        audioPath=intent.getExtras().getString(<span class="string">"audioPath"</span>);</span><br><span class="line"></span><br><span class="line">        MainActivity.txt.setText(audioPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(mediaPlayer != <span class="keyword">null</span> &amp;&amp; mediaPlayer.isPlaying())</span><br><span class="line">        &#123;</span><br><span class="line">            mediaPlayer.pause();</span><br><span class="line">            sendUpdateUI(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mediaPlayer == <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mediaPlayer = <span class="keyword">new</span> MediaPlayer();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    mediaPlayer.reset();</span><br><span class="line">                    mediaPlayer.setDataSource(audioPath);</span><br><span class="line">                    mediaPlayer.prepare();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    Log.e(<span class="string">"player"</span>,<span class="string">"player prepare() err"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            mediaPlayer.start();</span><br><span class="line">            sendUpdateUI(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> START_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mediaPlayer != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mediaPlayer.reset();</span><br><span class="line">            mediaPlayer.release();</span><br><span class="line">            mediaPlayer = <span class="keyword">null</span>;</span><br><span class="line">            sendUpdateUI(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-4-Broadcast-java"><a class="header-anchor" href="#4-3-4-Broadcast-java">¶</a>4.3.4 Broadcast.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Broadcast</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context,Intent intent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> backFlag=intent.getExtras().getInt(<span class="string">"backFlag"</span>);</span><br><span class="line">        <span class="keyword">switch</span> (backFlag)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                MainActivity.btnStart.setText(<span class="string">"暂停"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                MainActivity.btnStart.setText(<span class="string">"播放"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-5-PermisionUtils-java"><a class="header-anchor" href="#4-3-5-PermisionUtils-java">¶</a>4.3.5 PermisionUtils.java</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> zhj.com.ex5_3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.Manifest;</span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.app.ActivityCompat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermisionUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Storage Permissions</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_EXTERNAL_STORAGE = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String[] PERMISSIONS_STORAGE = &#123;</span><br><span class="line">            Manifest.permission.READ_EXTERNAL_STORAGE,</span><br><span class="line">            Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Checks if the app has permission to write to device storage</span></span><br><span class="line"><span class="comment">     * If the app does not has permission then the user will be prompted to</span></span><br><span class="line"><span class="comment">     * grant permissions</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">verifyStoragePermissions</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Check if we have write permission</span></span><br><span class="line">        <span class="keyword">int</span> permission = ActivityCompat.checkSelfPermission(activity,</span><br><span class="line">                Manifest.permission.WRITE_EXTERNAL_STORAGE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (permission != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            <span class="comment">// We don't have permission so prompt the user</span></span><br><span class="line">            ActivityCompat.requestPermissions(activity, PERMISSIONS_STORAGE,</span><br><span class="line">                    REQUEST_EXTERNAL_STORAGE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-6-AndroidManifest-xml"><a class="header-anchor" href="#4-3-6-AndroidManifest-xml">¶</a>4.3.6 AndroidManifest.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">"zhj.com.ex5_3"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>&gt;</span><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span>&gt;</span><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">"@mipmap/ic_launcher_round"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">".AudioService"</span> <span class="attr">android:enabled</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"music"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="五、实验总结"><a class="header-anchor" href="#五、实验总结">¶</a>五、实验总结</h2>
<p>这次实验中出现的问题还是比较多的，解决问题的过程也比较曲折，做了一些弯路，不过好在最后现有的问题都已得到解决。虽然这次实验中出现了很多问题，但通过解决问题，我也收获了很多编程方面的知识，能力得到了提升。<br>
在Android编程方面，主要掌握了以下问题：</p>
<ol>
<li>安卓资源文件命名问题</li>
<li>安卓版本控制问题</li>
<li>配置文件校验问题</li>
<li>设置监听事件的四种表达方式</li>
<li>动态权限申请问题</li>
<li>了解了service后台服务程序和Broadcast消息广播机制的实现过程</li>
</ol>
<h2 id="六、部分参考资料"><a class="header-anchor" href="#六、部分参考资料">¶</a>六、部分参考资料</h2>
<ol>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC84Mzk5Njk4ODdlMmM=" title="https://www.jianshu.com/p/839969887e2c">aapt2 工具介绍<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2t5aV96aHUxMjMvYXJ0aWNsZS9kZXRhaWxzLzUyNjAxNjkx" title="https://blog.csdn.net/kyi_zhu123/article/details/52601691">android 监听器实现的四种方式<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMzczMDM2ODc2L2FydGljbGUvZGV0YWlscy81MTEyMjQ3OQ==" title="https://blog.csdn.net/qq373036876/article/details/51122479">将文件放到Android模拟器的SD卡中的两种解决方法<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qaW5neWFuLmJhaWR1LmNvbS9hcnRpY2xlL2QxNjllMTg2MWU4ZDljNDM2NjExZDhmYS5odG1s" title="https://jingyan.baidu.com/article/d169e1861e8d9c436611d8fa.html">Android Studio3.3如何将电脑文件上传到模拟器<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzMjEwMDQyL2FydGljbGUvZGV0YWlscy83ODM0MTUxOA==" title="https://blog.csdn.net/qq_33210042/article/details/78341518">MediaPlayer基本使用方式<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpMnJmbDc4L2FydGljbGUvZGV0YWlscy83ODMxNDI4Ng==" title="https://blog.csdn.net/wi2rfl78/article/details/78314286">解决安卓7.0系统写入SD卡权限失败问题<i class="fa fa-external-link"></i></span></li>
</ol>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2019\06\20\Android_WebView\" rel="bookmark">Android——WebView网页应用</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2019\05\06\Android_Camera\" rel="bookmark">Android——简易照相机</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2020\02\24\Flutter-Start\" rel="bookmark">安装Flutter遇到的问题</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div>谢谢你请我喝快乐水 😜</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Zhang H.J. 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Zhang H.J. 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Zhang H.J.
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://zhj.forever305.cn/2019/05/19/Android_BackGround/" title="Android——后台服务">https://zhj.forever305.cn/2019/05/19/Android_BackGround/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

            <div class="social-item">
              <a target="_blank" class="social-link" href="https://github.com/ZHJ0125">
                <span class="icon">
                  <i class="fa fa-github"></i>
                </span>

                <span class="label">GitHub</span>
              </a>
            </div>

            <div class="social-item">
              <a target="_blank" class="social-link" href="https://blog.csdn.net/ZHJ123CSDN">
                <span class="icon">
                  <i class="fa fa-telegram"></i>
                </span>

                <span class="label">CSDN</span>
              </a>
            </div>

            <div class="social-item">
              <a target="_blank" class="social-link" href="/atom.xml">
                <span class="icon">
                  <i class="fa fa-rss"></i>
                </span>

                <span class="label">RSS</span>
              </a>
            </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/05/06/Android_Camera/" rel="prev" title="Android——简易照相机">
      <i class="fa fa-chevron-left"></i> Android——简易照相机
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/06/20/Android_WebView/" rel="next" title="Android——WebView网页应用">
      Android——WebView网页应用 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、后台音乐服务程序"><span class="nav-text">¶一、后台音乐服务程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-实验原理"><span class="nav-text">¶1.1 实验原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-实验过程记录"><span class="nav-text">¶1.2 实验过程记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1布局文件"><span class="nav-text">¶1.2.1布局文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2控制文件"><span class="nav-text">¶1.2.2控制文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-1实例化对象"><span class="nav-text">¶1.2.2.1实例化对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-2重载onCreate方法"><span class="nav-text">¶1.2.2.2重载onCreate方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-3编写mClick函数"><span class="nav-text">¶1.2.2.3编写mClick函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-4编写AudioSrv服务程序"><span class="nav-text">¶1.2.2.4编写AudioSrv服务程序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-5重载AudioSrv构造方法"><span class="nav-text">¶1.2.2.5重载AudioSrv构造方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-配置文件"><span class="nav-text">¶1.2.3 配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4引入音频文件资源"><span class="nav-text">¶1.2.4引入音频文件资源</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-实验中存在的问题及解决方案"><span class="nav-text">¶1.3 实验中存在的问题及解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-实验结果"><span class="nav-text">¶1.4 实验结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、信息广播程序"><span class="nav-text">¶二、信息广播程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1实验原理"><span class="nav-text">¶2.1实验原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-实验过程记录"><span class="nav-text">¶2.2 实验过程记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1布局文件"><span class="nav-text">¶2.2.1布局文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2控制文件"><span class="nav-text">¶2.2.2控制文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-1实例化对象"><span class="nav-text">¶2.2.2.1实例化对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-2重载onCreate方法"><span class="nav-text">¶2.2.2.2重载onCreate方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-3编写mClick函数"><span class="nav-text">¶2.2.2.3编写mClick函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-4编写TestReceiver控制程序"><span class="nav-text">¶2.2.2.4编写TestReceiver控制程序</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-配置文件"><span class="nav-text">¶2.2.3 配置文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-实验中存在的问题及解决方案"><span class="nav-text">¶2.3 实验中存在的问题及解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-实验结果"><span class="nav-text">¶2.4 实验结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、后台服务广播音乐的播放或暂停"><span class="nav-text">¶三、后台服务广播音乐的播放或暂停</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1实验原理"><span class="nav-text">¶3.1实验原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2实验过程记录"><span class="nav-text">¶3.2实验过程记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1布局文件"><span class="nav-text">¶3.2.1布局文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2控制文件"><span class="nav-text">¶3.2.2控制文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-1实例化对象"><span class="nav-text">¶3.2.2.1实例化对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-2重载onCreate方法"><span class="nav-text">¶3.2.2.2重载onCreate方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-3重载onDestroy方法"><span class="nav-text">¶3.2.2.3重载onDestroy方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-4编写ClickHandler函数"><span class="nav-text">¶3.2.2.4编写ClickHandler函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-5编写AudioService控制文件"><span class="nav-text">¶3.2.2.5编写AudioService控制文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-6编写-Broadcast控制文件"><span class="nav-text">¶3.2.2.6编写 Broadcast控制文件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3配置文件"><span class="nav-text">¶3.2.3配置文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-实验中存在的问题及解决方案"><span class="nav-text">¶3.3 实验中存在的问题及解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1安卓源文件链接失败问题"><span class="nav-text">¶3.3.1安卓源文件链接失败问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-ClickHandler方法未被调用问题"><span class="nav-text">¶3.3.2 ClickHandler方法未被调用问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3音乐服务不播放问题"><span class="nav-text">¶3.3.3音乐服务不播放问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4动态权限申请"><span class="nav-text">¶3.3.4动态权限申请</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4实验结果"><span class="nav-text">¶3.4实验结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、附录"><span class="nav-text">¶四、附录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-ex5-1"><span class="nav-text">¶4.1 ex5_1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-activity-main-xml"><span class="nav-text">¶4.1.1 activity_main.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-MainActivity-java"><span class="nav-text">¶4.1.2 MainActivity.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-AudioSrv-java"><span class="nav-text">¶4.1.3 AudioSrv.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-AndroidManifest-xml"><span class="nav-text">¶4.1.4 AndroidManifest.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-ex5-2"><span class="nav-text">¶4.2 ex5_2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-activity-main-xml"><span class="nav-text">¶4.2.1 activity_main.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-MainActivity-java"><span class="nav-text">¶4.2.2 MainActivity.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-TestReceiver-java"><span class="nav-text">¶4.2.3 TestReceiver.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-AndroidManifest-xml"><span class="nav-text">¶4.2.4 AndroidManifest.xml</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-ex5-3"><span class="nav-text">¶4.3 ex5_3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-activity-main-xml"><span class="nav-text">¶4.3.1 activity_main.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-MainActivity-java"><span class="nav-text">¶4.3.2 MainActivity.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-AudioService-java"><span class="nav-text">¶4.3.3 AudioService.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-4-Broadcast-java"><span class="nav-text">¶4.3.4 Broadcast.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-5-PermisionUtils-java"><span class="nav-text">¶4.3.5 PermisionUtils.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-6-AndroidManifest-xml"><span class="nav-text">¶4.3.6 AndroidManifest.xml</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、实验总结"><span class="nav-text">¶五、实验总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、部分参考资料"><span class="nav-text">¶六、部分参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhang H.J."
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Zhang H.J.</p>
  <div class="site-description" itemprop="description">Talk is cheap, Show me the code</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1pISjAxMjU=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ZHJ0125"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNoYW5kb25naG91amluQDE2My5jb20=" title="E-Mail → mailto:shandonghoujin@163.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9pbWFnZXMubmFzYS5nb3Yv" title="https:&#x2F;&#x2F;images.nasa.gov&#x2F;">NASA Image</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9naXRtZW1vcnkuY29tL1pISjAxMjU=" title="https:&#x2F;&#x2F;gitmemory.com&#x2F;ZHJ0125">GitMemory</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly93d3cudGhpbmdpdmVyc2UuY29tLw==" title="https:&#x2F;&#x2F;www.thingiverse.com&#x2F;">Thingiverse</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9sbmNuLm9yZy8=" title="https:&#x2F;&#x2F;lncn.org&#x2F;">Lncn 免费节点</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvRng2enRGcFlLUVlEN1dXNU9UYl9BZw==" title="https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;Fx6ztFpYKQYD7WW5OTb_Ag">魔方机器人</span>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang H.J.</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">156k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:20</span>
</div>

<!--
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Gemini</span> v7.7.1
  </div>
-->


<!--The following is what my add for "site building time" function-->
<span id="sitetime"></span>
<script language=javascript>
  function siteTime(){
    window.setTimeout("siteTime()", 1000);
    var seconds = 1000;
    var minutes = seconds * 60;
    var hours = minutes * 60;
    var days = hours * 24;
    var years = days * 365;
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
    year - 作为date对象的年份，为4位年份值
    month - 0-11之间的整数，做为date对象的月份
    day - 1-31之间的整数，做为date对象的天数
    hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
    minutes - 0-59之间的整数，做为date对象的分钟数
    seconds - 0-59之间的整数，做为date对象的秒数
    microseconds - 0-999之间的整数，做为date对象的毫秒数 */
    var t1 = Date.UTC(2020,01,25,00,00,00); //这里调整博客建站时间，时间：2019-05-14 00:00:00
    var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = t2-t1;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
    document.getElementById("sitetime").innerHTML="本站点已运行 "+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
  }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
  siteTime();
</script>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,191,255' opacity='0.6' zIndex='-1' count='200' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout: 3000,
        priority: true,
        ignores: [uri => uri.includes('#'),uri => uri == 'https://zhj.forever305.cn/2019/05/19/Android_BackGround/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : 'z1HKdL8Pg1E7A7AHIaEh4svT-gzGzoHsz',
      appKey     : 'M7D0zph9dDHw3vNFWKRnGbhv',
      placeholder: "😏对这篇博客有疑问？在这里留言吧！留下您的邮箱，系统可以自动向您发送提醒邮件",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
